description: Notify Ship

parameters:
  completed:
    type: string
    default: "true"
    description: |
      Override this to "false" when calling Ship at the beginning of your job to show that a run is in progress
  org:
    type: string
    default: ""
    description: |
      By default Ship uses the CircleCI "Project Username" as your Ship Organization name,
      since that is typically the same as your Github Organization. In case you need to override
      your Ship Org you can either specify it with this org parameter, alternatively
      you can set the SHIP_ORG environment variable in your project settings, or context.
  host:
    type: string
    description: |
      IGNORE - only overridden for orb-development purposes
    default: "api.backend.shipapp.io"

steps:
  - run:
      when: on_fail
      name: Ship - Detecting Job Status (FAIL)
      command: |
        echo 'export CCI_STATUS="fail"' > /tmp/SHIP_JOB_STATUS
  - run:
      when: on_success
      name: Ship - Detecting Job Status (PASS)
      command: |
        echo 'export CCI_STATUS="pass"' > /tmp/SHIP_JOB_STATUS
  - run:
      when: always
      environment:
        SHIP_ORG_PARAM: <<parameters.org>>
        SHIP_COMPLETED: <<parameters.completed>>
        SHIP_HOST: <<parameters.host>>
      name: Notify Ship
      command: <<include(scripts/notify.sh)>>
